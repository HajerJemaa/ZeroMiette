<div class="content">
    @if (activeTab === 'dashboard') {
      <p>Dashboard is working</p>

      <div class="page">
        <div class="profile-header">
          <img [src]="user?.profile_pic || '/assets/default-profile.png'" alt="Profile" width="50">
          <span>{{ user?.user_name }}</span>
        </div>
        <div class="donation-prompt" (click)="openAnnouncementModel()">
          Got any donation today?
        </div>
        @if (announcements.length > 0) {
          <div class="row mt-3">
            @for (announcement of announcements; track announcement.annCode) {
              <div class="col-md-4">
                <div class="card announcement-card">
                  <div class="card-header">
                    <img [src]="user?.profile_pic || '/assets/default-profile.jpg'" alt="Profile">
                    <span class="ms-2">{{ user?.user_name }}</span>
                    <small>{{ formatDateForInput(announcement.dateC) }}</small>
                    <div class="dropdown">
                      <button class="btn btn-link" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" (click)="openAnnouncementModel(announcement)">Edit</a></li>
                        <li><a class="dropdown-item" href="#" (click)="deleteAnnouncement(announcement.annCode)">Delete</a></li>
                      </ul>
                    </div>
                  </div>
                  <img [src]="announcement.img || '/assets/default-food.jpg'" class="food-img" alt="Food">
                  <div class="card-body">
                    <h5 class="card-title">{{ announcement.title }}</h5>
                    <p class="card-text">{{ announcement.content }}</p>
                    <p><strong>Quantity:</strong> {{ announcement.quantity }}</p>
                    <p><strong>Deadline:</strong> {{ formatDateForInput(announcement.deadline) }}</p>
                    <span class="badge" [ngClass]="{'bg-success': countdowns[announcement.annCode] !== 'Expired', 'bg-danger': countdowns[announcement.annCode] === 'Expired'}">{{ countdowns[announcement.annCode] }}</span>
                    <button class="btn btn-secondary mt-2" (click)="openRequestModel(announcement.annCode)">Requests</button>
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <p>No announcements available.</p>
        }
      </div>
    } @else if (activeTab === 'myAnnouncements') {
      <div class="page">
        <h1>My Announcements</h1>
        @if (announcements.length > 0) {
          <div class="row mt-3">
            @for (announcement of announcements; track announcement.annCode) {
              <div class="col-md-4">
                <div class="card announcement-card">
                  <div class="card-header">
                    <img [src]="user?.profile_pic || '/assets/default-profile.jpg'" alt="Profile">
                    <span class="ms-2">{{ user?.user_name }}</span>
                    <small>{{ formatDateForInput(announcement.dateC) }}</small>
                    <div class="dropdown">
                      <button class="btn btn-link" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" (click)="openAnnouncementModel(announcement)">Edit</a></li>
                        <li><a class="dropdown-item" href="#" (click)="deleteAnnouncement(announcement.annCode)">Delete</a></li>
                      </ul>
                    </div>
                  </div>
                  <img [src]="announcement.img || '/assets/default-food.jpg'" class="food-img" alt="Food">
                  <div class="card-body">
                    <h5 class="card-title">{{ announcement.title }}</h5>
                    <p class="card-text">{{ announcement.content }}</p>
                    <p><strong>Quantity:</strong> {{ announcement.quantity }}</p>
                    <p><strong>Deadline:</strong> {{ formatDateForInput(announcement.deadline) }}</p>
                    <span class="badge" [ngClass]="{'bg-success': countdowns[announcement.annCode] !== 'Expired', 'bg-danger': countdowns[announcement.annCode] === 'Expired'}">{{ countdowns[announcement.annCode] }}</span>
                    <button class="btn btn-secondary mt-2" (click)="openRequestModel(announcement.annCode)">Requests</button>
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <p>No announcements found.</p>
        }
      </div>
    }

    @if (showAnnouncementsModel) {
      <div class="modal-backdrop" (click)="closeCreateAnnouncementModel()"></div>
      <div class="modal-dialog modal-content">
        <form (ngSubmit)="onSubmit()" [formGroup]="form">
          <div class="modal-header">
            <h5 class="modal-title">{{ isEdit ? 'Edit Announcement' : 'Create Announcement' }}</h5>
            <button type="button" class="btn-close" (click)="closeCreateAnnouncementModel()"></button>
          </div>
          <div class="modal-body">
            <input formControlName="title" class="form-control" placeholder="Title" required>
            <textarea formControlName="content" class="form-control" placeholder="Content" required></textarea>
            <input formControlName="quantity" class="form-control" placeholder="Quantity (e.g., 10 kg)" required>
            <input formControlName="deadline" type="datetime-local" class="form-control" required>
            <div class="mb-3">
              <label class="form-label">Recipient Type</label>
              <div>
                <input type="radio" formControlName="recipientType" id="human" value="human" required>
                <label for="human">Human</label>
                <input type="radio" formControlName="recipientType" id="animal" value="animal">
                <label for="animal">Animal</label>
              </div>
            </div>
            <input formControlName="image" type="file" (change)="onFileChange($event)" class="form-control" accept="image/*">
            @if (imagePreview) {
              <img [src]="imagePreview" alt="Preview" style="max-width: 100px;">
            }
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeCreateAnnouncementModel()">Cancel</button>
            <button type="submit" class="btn btn-primary">{{ isEdit ? 'Save Changes' : 'Submit' }}</button>
          </div>
        </form>
      </div>
    }
  
    @if (showRequestModel && selectedAnnCode) {
      <div class="modal-backdrop" (click)="closeRequestModel(selectedAnnCode)"></div>
      <div class="modal-dialog modal-lg modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Requests for Announcement</h5>
          <button type="button" class="btn-close" (click)="closeRequestModel(selectedAnnCode)"></button>
        </div>
        <div class="modal-body">
          <h6>Pending Requests</h6>
          @for (request of requests ; track $index) {
            @if (request.state === 'pending') {
              <div class="request-card">
                <img [src]="requesterDetails[request.userId]?.profile_pic || '/assets/default-profile.jpg'" alt="Profile">
                <div class="request-info">
                  <strong>{{ requesterDetails[request.userId]?.username || 'Unknown' }}</strong>
                  <small class="text-muted">{{ formatDateForInput(request.dateC) }}</small>
                  <p>{{ request.description }}</p>
                  <div class="status">Pending</div>
                </div>
                <div class="request-actions">
                  <button class="btn btn-success btn-sm" (click)="acceptRequest(request)">Accept</button>
                  <button class="btn btn-danger btn-sm" (click)="refuseRequest(request)">Refuse</button>
                </div>
              </div>
            }
          }
          <h6 class="mt-3">Accepted Requests</h6>
          @for (request of requests ; track $index) {
            @if (request.state === 'accepted') {
              <div class="request-card">
                <img [src]="requesterDetails[request.userId]?.profile_pic || '/assets/default-profile.jpg'" alt="Profile">
                <div class="request-info">
                  <strong>{{ requesterDetails[request.userId]?.username || 'Unknown' }}</strong>
                  <small class="text-muted">{{ formatDateForInput(request.dateC) }}</small>
                  <p>{{ request.description }}</p>
                  <p><strong>Contact:</strong> {{ requesterDetails[request.userId]?.email }}</p>
                  <div class="status">Accepted</div>
                </div>
              </div>
            }
          }
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeRequestModel(selectedAnnCode)">Close</button>
        </div>
      </div>
    }
  </div>