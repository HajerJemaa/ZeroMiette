<div class="container mt-5">
  <h2 class="mb-4 text-center" style="color: #1f4d36;" >📋 Mes Demandes</h2>

  <div class="d-flex justify-content-center gap-3 mb-4">
    <button class="btn btn-outline" style="color: #1f4d36;" (click)="getUserRequestsByState('pending')">
      ⏳ En attente
    </button>
    <button class="btn btn-outline" style="color: #1f4d36;" (click)="getUserRequestsByState('accepted')">
      ✅ Acceptées
    </button>
    <button class="btn btn-outline" style="color: #1f4d36;" (click)="getUserRequestsByState('refused')">
      ❌ Refusées
    </button>
  </div>

  @if (errorMessage) {
    <div class="alert alert-warning text-center">{{ errorMessage }}</div>
  } 
  @else if (requests.length > 0) {
    <div class="row">

      @for (req of requests; track req.annCode) {
        <div class="card shadow-sm" style="border: 2px solid #1f4d36;">
          <div class="card-body" style="background-color: #f8f9f6;">
            
            <!-- Nom du donneur et Délai -->
            <div class="row" >
              <div class="col-7">
                <h5 class="card-title" style="color: #380303;">title</h5>
              </div>
              <div class="col-2"></div>
              <div class="col-3  text-end">
                <strong style="color: #1f4d36;">dateC:</strong>
                <span style="color: #570505;">{{req.dateC}}</span>
              </div>
            </div>

            <!-- Catégorie -->
            <div class="row">
              <div class="col-6 ">
                <div class="row">
                  <div class="col">
                  <strong style="color: #1f4d36;">From:</strong>
                  <p>donor name</p>
                </div>
              </div>
  
              <!-- Description de l'annonce -->
              <!-- Description -->
<div class="row">
  <div class="col">
    <strong style="color: #1f4d36;">Description :</strong>
    @if (editMode[req.annCode]) {
      <input class="form-control" type="text" [(ngModel)]="req.description">
    } @else {
      <p>{{ req.description }}</p>
    }
  </div>
</div>

<!-- Quantité -->
<div class="row">
  <div class="col">
    <strong style="color: #1f4d36;">Quantité demandée :</strong>
    @if (editMode[req.annCode]) {
      <input class="form-control" type="number" [(ngModel)]="req.quantity">
    } @else {
      <p>{{ req.quantity }}kg</p>
    }
  </div>
</div>

<!-- Boutons -->
@if (req.state == 'pending' || req.state == 'refused') {
  <div class="row mt-2">
    <div class="col-6">
      <button class="btn btn-outline-danger" (click)="deleteRequest(req.annCode)">🗑️ Supprimer</button>
    </div>
    <div class="col-6 text-end">
      @if (editMode[req.annCode]) {
        <button class="btn btn-success" (click)="saveRequestUpdate(req)">💾 Enregistrer</button>
      } @else {
        <button class="btn btn-outline-primary" (click)="editMode[req.annCode] = true">✏️ Modifier</button>
      }
    </div>
  </div>
}
